---
title: "高可用部署"
---

> 基于阿里云实现高可用项目部署

##### 服务器购买

> 方案: 通过nginx做负载均衡

服务器1: nfs共享盘服务
磁盘: 挂载到服务器1中
服务器2: nginx负载均衡服务
服务器3: 安装至轻云1
服务器4: 安装至轻云2
服务器5: 安装至轻云3

系统： centos7

| 服务器名 | 公网ip           | 内网ip          |
|------|----------------|---------------|
| 服务器1 | 39.100.109.251 | 172.16.215.87 |
| 服务器2 | 39.100.105.105 | 172.16.215.88 |
| 服务器3 | 39.100.109.7   | 172.16.215.86 |
| 服务器4 | 39.100.101.75  | 172.16.215.85 |
| 服务器5 | 39.100.101.181 | 172.16.215.84 |

##### 挂载磁盘

参考： linux 挂载磁盘

##### 安装nfs服务

参考： linux 安装nfs服务

##### 安装nginx服务

参考： nginx 负载均衡配置

##### 安装至轻云服务

参考： 安装包部署

```bash
vim zhiqingyun/conf/application-local.yml
```

> 注意修改配置资源文件目录，指向共享盘

```yaml
# 服务端口号
server:
  port: 8080

spring:

  # 配置后台服务,设置管理员账号密码
  # druid: http://localhost:8080/druid/index.html
  # h2: http://localhost:8080/h2-console
  # swagger: http://localhost:8080/swagger-ui/index.html
  security:
    user:
      name: admin
      password: admin1234

  # 业务数据库的配置信息，默认使用h2数据库
  # h2驱动: org.h2.Driver
  # mysql驱动: com.mysql.cj.jdbc.Driver，需要空的db，首次启动日志有warning，忽略不计
  datasource:
    driver-class-name: org.h2.Driver
    url: jdbc:h2:file:/data/zhiqingyun/h2/data;AUTO_SERVER=TRUE
    username: root
    password: root1234

# 应用配置
isx-app:
  resources-path: /data/zhiqingyun/ # 资源文件，例如许可证、驱动、头像等资源路径
  admin-passwd: admin1234 # 配置至轻云后台admin账号的密码
  use-ssl: false # 是否开启ssl
  docker-mode: false # 是否采用docker部署模式
```

> 启动项目

```bash
bash zhiqingyun/bin/start.sh
```

- 访问nginx负载均衡地址
- http://39.100.105.105